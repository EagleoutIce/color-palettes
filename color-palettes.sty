%% color-palettes.sty
%%
%% --------------------------------------------------------------------------
%%
%% Autor: Florian Sihler, 22.08.2020
%%
%% This package allows to use palettes and handle them in differnt ways.
%%

% All internal commands are prefixed by 'cpl'

\ProvidesPackage{color-palettes}[2020/08/22 v1.1 a color and palette control package based on xcolor] 

%% Options
%% -----------------------------------------------------------------------------

\newif\ifcpl@setup@hyperref@
\DeclareOption{hyperref}{\cpl@setup@hyperref@true}
\DeclareOption{nohyperref}{\cpl@setup@hyperref@false}

\newif\ifcpl@setup@enumitem@
\DeclareOption{enumitem}{\cpl@setup@enumitem@true}
\DeclareOption{noenumitem}{\cpl@setup@enumitem@false}

\newif\ifcpl@setup@defaults@ \cpl@setup@defaults@true
\DeclareOption{defaults}{\cpl@setup@defaults@true}
\DeclareOption{nodefaults}{\cpl@setup@defaults@false}

\newif\ifcpl@setup@addons@
\DeclareOption{addons}{\cpl@setup@addons@true}
\DeclareOption{noaddons}{\cpl@setup@addons@false}

\ProcessOptions*%

%% Packages
%% -----------------------------------------------------------------------------

\RequirePackage{xcolor}

%% Definitions
%% -----------------------------------------------------------------------------

\def\cpl@none{<None>}
\edef\cpl@registered@palettes{\cpl@none}

\def\AllPalettes{\cpl@registered@palettes}

% #1 name of palette
% #2-#5 colors in the format 'name,adjective: format(CODE)'
%       example: "Blau,bläulich: RGB(0,0,255)"
\newcommand*{\DefinePalette}[5]{%
    \edef\@cpl@tmp{#1}\expandafter\ifx\expandafter\\\@cpl@tmp\\\cpl@err@noname@palette\fi%
    \typeout{Defining palette '#1'}%
    \expandafter\gdef\csname cpl@palette@#1\endcsname{%
        \expandafter\cpl@parse@colordata{A}#2\@nil%
        \expandafter\cpl@parse@colordata{B}#3\@nil%
        \expandafter\cpl@parse@colordata{C}#4\@nil%
        \expandafter\cpl@parse@colordata{D}#5\@nil%
    }%
    \ifx\cpl@registered@palettes\cpl@none%
        \xdef\cpl@registered@palettes{#1}%
    \else%
        \xdef\cpl@registered@palettes{\cpl@registered@palettes, #1}%
    \fi%
}%

\def\cpl@shade@contrast{24}
\newcommand*{\SetShadeContrast}[1]{\gdef\cpl@shade@contrast{#1}}

\def\cpl@parse@colordata#1#2,#3: #4(#5)\@nil{%
    \definecolor{palette#1}{#4}{#5}\colorlet{shade#1}{palette#1!\cpl@shade@contrast!white}%
    \expandafter\gdef\csname palette#1name\endcsname{#2}%
    \expandafter\gdef\csname palette#1adj\endcsname{#3}%
}

\def\cpl@err@noname@palette{\PackageError{color-palettes}{A palette must have a name}
{An empty name for a palette is reserved and not to be used}}

\def\cpl@err@unkown@palette#1{\PackageError{color-palettes}{Unknown palette '#1'}
{There is no palette registered with the name '#1'\MessageBreak
 Register a palette with: \protect\DefinePalette{name}{...}\MessageBreak
 Registered Palettes: \cpl@registered@palettes}}

\def\CurrentPalette{}

\def\cpl@undef#1{%
    \expandafter\gdef\csname #1name\endcsname\@nil%
    \expandafter\gdef\csname #1adj\endcsname\@nil%
}
% clears all registers
\def\cpl@clear@palette{%
    \cpl@undef{paletteA}\cpl@undef{paletteB}\cpl@undef{paletteC}\cpl@undef{paletteD}%
}

\newif\ifcpl@first@palette@usage@
\newcommand*{\UsePalette}[1]{\edef\cpl@plt{#1}\expandafter\ifx\expandafter\\\cpl@plt\\\relax \cpl@clear@palette\gdef\CurrentPalette{}\else%
\typeout{Using palette '#1'}%
\@ifundefined{cpl@palette@#1}{\cpl@err@unkown@palette{#1}}{\@nameuse{cpl@palette@#1}}\cpl@hooks\cpl@first@palette@usage@true\xdef\CurrentPalette{#1}\fi}

\newcommand{\WithPalette}[2]{%
\bgroup%
\edef\@cpl@tmp{\CurrentPalette}%
\UsePalette{#1}#2%
\UsePalette{\@cpl@tmp}% in case of none
\egroup}

\newcommand*{\ShowcasePalette}[1]{%
    \WithPalette{#1}{\ShowcaseCurrentPalette}%
}

\def\cpl@showcase@palette#1{%
    \strut\emph{palette#1} & \colorbox{palette#1}{\vphantom{A}~~$\,$}$\,$\colorbox{shade#1}{\vphantom{A}~~$\,$} & \@nameuse{palette#1name} & \@nameuse{palette#1adj}%
}

\newcommand*{\ShowcaseCurrentPalette}{%
\bgroup%
    \renewcommand{\arraystretch}{1.5}\begin{tabular}{ccll}%
        \multicolumn{4}{c}{\textbf{Palette: \strut\textit{\CurrentPalette}}}\\
        ~Identifier~ & ~~Color~~ & Noun~~~~~~~~~~~ & Adjective~~~~~~~~~~ \\
        \hline
        \cpl@showcase@palette{A} \\ %
        \cpl@showcase@palette{B} \\ %
        \cpl@showcase@palette{C} \\ %
        \cpl@showcase@palette{D} \\ %
    \end{tabular}%
\egroup}

\long\def\paletteA#1{\textcolor{paletteA}{#1}}
\long\def\paletteB#1{\textcolor{paletteB}{#1}}
\long\def\paletteC#1{\textcolor{paletteC}{#1}}
\long\def\paletteD#1{\textcolor{paletteD}{#1}}

%% The default palettes
%% -----------------------------------------------------------------------------

\DefinePalette{Water}
{Dunkelblau,dunkelbläulich: RGB(17, 26, 68)}
{Blau,bläulich: RGB(36, 63, 120)}
{Hellblau,hellbläulich: RGB(43, 106, 131)}
{Rot,rötlich: RGB(145,47,64)}

\DefinePalette{GraySun}
{Dunkelgrau,dunkelgräulich: RGB(32, 43, 65)}
{Grau,gräulich: RGB(81, 91, 116)}
{Hellgrau,hellgräulich: RGB(157, 171, 197)}
{Gelb,gelblich: RGB(217, 226, 59)}

\DefinePalette{ClayGrass}
{Dunkelbraun,dunkelbräunlich: RGB(90, 51, 46)}
{Hellbraun,hellbräunlich: RGB(142, 94, 90)}
{Rosa,rosafarben: RGB(218, 179, 172)}
{Grün,grünlich: RGB(36, 73, 22)}

\DefinePalette{PurpleCoin}
{Dunkellila,dunkellilafarben: RGB(64, 47, 83)}
{Lila,lilafarben: RGB(113, 90, 134)}
{Helllila,helllilafarben: RGB(186, 169, 205)}
{Bronze,bronzefarben: RGB(188, 118, 66)}

\DefinePalette{Moonshine}
{Dunkelgrün,dunkelgrünlich: RGB(32, 63, 57)}
{Blaugrau,blaugräulich: RGB(65, 101, 97)}
{Hellblau,hellbläulich: RGB(163, 195, 192)}
{Gold,goldfarben: RGB(218, 188, 78)}

\DefinePalette{BloodyGrass}
{Dunkelgrün,dunkelgrünlich: RGB(27, 58, 24)}
{Grün,grünlich: RGB(65, 112, 70)}
{Hellgrün,hellgrünlich: RGB(142, 190, 140)}
{Rot,rötlich: RGB(128, 46, 48)}

\DefinePalette{SourCandy}
{Dunkelrot,dunkelrötlich: RGB(110, 47, 58)}
{Rot,rötlich: RGB(171, 87, 102)}
{Hellrot,hellrötlich: RGB(226, 139, 155)}
{Grün,grünlich: RGB(162, 226, 139)}

\DefinePalette{PurpleSand}
{Dunkellila,dunkellilafarben: RGB(52, 31, 74)}
{Lila,lilafarben: RGB(83, 62, 105)}
{Helllila,helllilafarben: RGB(156, 141, 172)}
{Gold,goldfarben: RGB(198, 162, 66)}

\DefinePalette{IceLake}
{Dunkelblau,dunkelbläulich: RGB(43, 60, 84)}
{Blau,bläulich: RGB(75,101,135)}
{Hellblau,hellbläulich: RGB(113, 151, 172)}
{Rot,rötlich: RGB(137,64,75)}

\DefinePalette{Crimson}
{Dunkelrot,dunkelrot: RGB(130, 0, 40)}
{Rot,rötlich: RGB(159, 36, 44)}
{Hellrot,hellrötlich: RGB(246, 77, 82)}
{Blau,bläulich: RGB(23, 159, 143)}

\DefinePalette{Legacy}
{Lila,lila: RGB(104, 34, 139)}
{Orange,orange: RGB(255, 140, 0)}
{Blau,bläulich: RGB(0, 74, 148)}
{Grün,grünlich: RGB(141, 182, 0)}

\DefinePalette{LegacyPrint}
{Grau,gräulich: RGB(151, 152, 151)}
{Hellgrau,hellgräulich: RGB(224, 224, 224)}
{Schwarz,schwarz: RGB(52, 52, 52)}
{Weißgrau,weißgräulich: RGB(245, 245, 243)}

\DefinePalette{GrayPrint}
{Dunkelgrau,dunkelgräulich: RGB(51, 51, 51)}
{Grau,gräulich: RGB(95, 95, 95)}
{Hellgrau,hellgräulich: RGB(154,154,154)}
{Weißgrau,weißgräulich: RGB(216,216,216)}

\DefinePalette{Rainbow}
{Rot,rötlich: RGB(218, 66, 129)}
{Blau,bläulich: RGB(0, 141, 211)}
{Grün,grünlich: RGB(134, 150, 0)}
{Gelb,gelblich: RGB(186, 135, 0)}

\ifcpl@setup@addons@
\DefinePalette{Lucy}
{Orange,orange: RGB(245, 130, 32)}
{Dunkelgrau,dunkelgräulich: RGB(126, 126, 126)}
{Grau,gräulich: RGB(167, 167, 167)}
{Lila,lilafarben: RGB(115, 92, 142)}
\DefinePalette{UniInfo}
{Rot,rötlich: RGB(163, 38, 56)}
{Beige,beigefarben: RGB(169, 162, 141)}
{Hellbeige,hellbeige: RGB(189, 194, 139)}
{Blau,bläulich: RGB(125, 154, 170)}
\DefinePalette{UniMawi}
{Grün,grünlich: RGB(86, 170, 28)}
{Beige,beigefarben: RGB(169, 162, 141)}
{Hellbeige,hellbeige: RGB(189, 194, 139)}
{Blau,bläulich: RGB(125, 154, 170)}
\DefinePalette{UniNawi}
{Orange,orange: RGB(189, 96, 5)}
{Beige,beigefarben: RGB(169, 162, 141)}
{Hellbeige,hellbeige: RGB(189, 194, 139)}
{Blau,bläulich: RGB(125, 154, 170)}
\DefinePalette{UniMed}
{Dunkelblau,dunkelbläulich: RGB(38, 84, 124)}
{Beige,beigefarben: RGB(169, 162, 141)}
{Hellbeige,hellbeige: RGB(189, 194, 139)}
{Blau,bläulich: RGB(125, 154, 170)}
\DefinePalette{Ntts}
{Bond-Gold,golden: RGB(150,128,081)}
{Hellgold,hellgolden: RGB(236,200,128)}
{Grau,gräulich: RGB(154,154,154)}
{Bond-Rot,rötlich: RGB(153,007,051)}
\DefinePalette{PastelRainbow}
{Blau,bläulich: RGB(37, 162, 166)}
{Gelb,gelblich: RGB(253, 221, 98)}
{Grün,grünlich: RGB(164, 208, 95)}
{Rot,rötlich: RGB(244, 143, 151)}
\DefinePalette{Vampire}
{Dunkelblau,dunkelbläulich: RGB(6, 30, 62)}
{Dunkellila,dunkellila: RGB(37, 30, 62)}
{Lila,lila: RGB(69, 30, 62)}
{Rot,rötlich: RGB(133, 30, 62)}
\fi

%% Option-Execution
%% -----------------------------------------------------------------------------

\def\cpl@hooks{%
    \cpl@hyper@hook%
    \cpl@enum@hook%
}

\ifcpl@setup@hyperref@
\AtBeginDocument{% initial:
    \hypersetup{%
        pdfborder=0 0 0%
    }%
}
\def\cpl@hyper@hook{%
\ifcpl@first@palette@usage@\hypersetup{allcolors=paletteA}%
\else\hypersetup{%
    colorlinks=true,%
    allcolors=paletteA%
}\fi%
}%
\else
\def\cpl@hyper@hook{}%
\fi

\ifcpl@setup@enumitem@
\RequirePackage{amssymb}
\def\cpl@enum@hook{%
\setlist[itemize,1]{label={\textcolor{shadeA}{$\blacktriangleright$}}}%
\setlist[itemize,2]{label={\textcolor{shadeA}{\smaller[2]\raisebox{2pt}{$\blacksquare$}}}}%
\setlist[itemize,3]{label={\textcolor{shadeA}{\raisebox{1.45pt}{\textendash}}}}%
\setlist[itemize,4]{label={\textcolor{shadeA}{\smaller[1]\raisebox{0.25pt}{*}}}}%
}
\else
\def\cpl@enum@hook{}%
\fi

\AtBeginDocument{\cpl@hooks}

%% Defaults
%% -----------------------------------------------------------------------------
\def\cpl@default@palette{IceLake}

\ifcpl@setup@defaults@
\UsePalette{\cpl@default@palette}
\fi

\endinput